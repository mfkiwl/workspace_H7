## H750VBT6_RTX_MEMORY_01

> 创建日期：2023-03-20

## 关于

在 [H750VBT6_chapter_27](https://github.com/oldgerman/workspace_H7/tree/master/H750VBT6_chapter_27) 的基础上修改，将 rtx_memory 的两个文件 打包到 C++（ osRtxMemory 类）

- 开发环境：STM32CubeIDE v1.11.2 + STM32CubeMX v6.6
- 包版本：STM32CubeH7 V1.11.0 / 04-Nov-2022
- 主RAM：DTCM

## 典例

```c
/*       Memory Pool        Size [KB  *1024/8]                  Section       */
uint64_t MEMPOOL_DTCM            [64  *1024/8]  __attribute__((section(".RAM_DTCM_Array")));
/* osRtxMemory objecct */
osRtxMemory DRAM_DTCM    (MEMPOOL_DTCM,       sizeof(MEMPOOL_DTCM));
/* Allocated Memory Address */
void *DTCM_Addr0;
    
void Demo()
{
    /* 从DTCM申请280字节空间，使用指针变量DTCM_Addr0操作这些空间时不要超过280字节大小 */
    printf("=========================================================\r\n");
    DTCM_Addr0 = DRAM_DTCM.malloc(280, 0);
    printf("DTCM总大小 = %d字节，申请大小 = 0280字节，当前共使用大小 = %d字节，当前剩余大小 = %d字节，历史最少可用大小 = %d字节\r\n",
           DRAM_DTCM.getMemSize(), DRAM_DTCM.getMemUsed(), DRAM_DTCM.getMemFree(), DRAM_DTCM.getMemFreeMin());

    /* 释放从DTCM申请的280字节空间 */
    DRAM_DTCM.free(DTCM_Addr0);
    printf("释放DTCM动态内存区申请的0280字节，当前共使用大小 = %d字节，当前剩余大小 = %d字节，历史最少可用大小 = %d字节\r\n",
           DRAM_DTCM.getMemUsed(), DRAM_DTCM.getMemFree(), DRAM_DTCM.getMemFreeMin());
}
```

## 测试

向 USB VCP 输入 R0、R1、R2...R8 即可测试例程

```shell
[led_task] sysTick : 5002 ms
操作提示:
1. 从DTCM依次申请280字节，64字节和6111字节
2. 释放从DTCM申请的空间
3. 从AXI SRAM依次申请160字节，32字节和2333字节
4. 释放从AXI SRAM申请的空间
5. 从D2域SRAM依次申请200字节，96字节和4111字节
6. 释放从D2域SRAM申请的空间
7. 从D3域SRAM依次申请300字节，128字节和5111字节
8. 释放从D3域SRAM申请的空间
[led_task] sysTick : 10002 ms
=========================================================
DTCM总大小 = 65536字节，申请大小 = 0280字节，当前共使用大小 = 304字节，当前剩余大小 = 65232字节，历史最少可用大小 = 65232字节
DTCM总大小 = 65536字节，申请大小 = 0064字节，当前共使用大小 = 376字节，当前剩余大小 = 65160字节，历史最少可用大小 = 65160字节
DTCM总大小 = 65536字节，申请大小 = 6111字节，当前共使用大小 = 6496字节，当前剩余大小 = 59040字节，历史最少可用大小 = 59040字节
[led_task] sysTick : 15002 ms
释放DTCM动态内存区申请的0280字节，当前共使用大小 = 6208字节，当前剩余大小 = 59328字节，历史最少可用大小 = 59040字节
释放DTCM动态内存区申请的0064字节，当前共使用大小 = 6136字节，当前剩余大小 = 59400字节，历史最少可用大小 = 59040字节
释放DTCM动态内存区申请的6111字节，当前共使用大小 = 16字节，当前剩余大小 = 65520字节，历史最少可用大小 = 59040字节
[led_task] sysTick : 20002 ms
=========================================================
AXI SRAM总大小 = 524288字节，申请大小 = 0162字节，当前共使用大小 = 184字节，当前剩余大小 = 524104字节，历史最少可用大小 = 524104字节
AXI SRAM总大小 = 524288字节，申请大小 = 0032字节，当前共使用大小 = 224字节，当前剩余大小 = 524064字节，历史最少可用大小 = 524064字节
AXI SRAM总大小 = 524288字节，申请大小 = 2333字节，当前共使用大小 = 2568字节，当前剩余大小 = 521720字节，历史最少可用大小 = 521720字节
释放AXI SRAM动态内存区申请的0160字节，当前共使用大小 = 2400字节，当前剩余大小 = 521888字节，历史最少可用大小 = 521720字节
释放AXI SRAM动态内存区申请的0032字节，当前共使用大小 = 2360字节，当前剩余大小 = 521928字节，历史最少可用大小 = 521720字节
释放AXI SRAM动态内存区申请的2333字节，当前共使用大小 = 16字节，当前剩余大小 = 524272字节，历史最少可用大小 = 521720字节
[led_task] sysTick : 25002 ms
=========================================================
D2域SRAM总大小 = 131072字节，申请大小 = 0200字节，当前共使用大小 = 512字节，当前剩余大小 = 130560字节，历史最少可用大小 = 130560字节
D2域SRAM总大小 = 131072字节，申请大小 = 0096字节，当前共使用大小 = 616字节，当前剩余大小 = 130456字节，历史最少可用大小 = 130456字节
D2域SRAM总大小 = 131072字节，申请大小 = 4111字节，当前共使用大小 = 4736字节，当前剩余大小 = 126336字节，历史最少可用大小 = 126336字节
[led_task] sysTick : 30002 ms
释放D2域SRAM动态内存区申请的0200字节，当前共使用大小 = 4528字节，当前剩余大小 = 126544字节，历史最少可用大小 = 126336字节
释放D2域SRAM动态内存区申请的0096字节，当前共使用大小 = 4424字节，当前剩余大小 = 126648字节，历史最少可用大小 = 126336字节
释放D2域SRAM动态内存区申请的4111字节，当前共使用大小 = 304字节，当前剩余大小 = 130768字节，历史最少可用大小 = 126336字节
[led_task] sysTick : 35002 ms
=========================================================
D3域SRAM总大小 = 65536字节，申请大小 = 0300字节，当前共使用大小 = 328字节，当前剩余大小 = 65208字节，历史最少可用大小 = 65208字节
D3域SRAM总大小 = 65536字节，申请大小 = 0128字节，当前共使用大小 = 464字节，当前剩余大小 = 65072字节，历史最少可用大小 = 65072字节
D3域SRAM总大小 = 65536字节，申请大小 = 5111字节，当前共使用大小 = 5584字节，当前剩余大小 = 59952字节，历史最少可用大小 = 59952字节
释放D3域SRAM动态内存区申请的0300字节，当前共使用大小 = 5272字节，当前剩余大小 = 60264字节，历史最少可用大小 = 59952字节
释放D3域SRAM动态内存区申请的0128字节，当前共使用大小 = 5136字节，当前剩余大小 = 60400字节，历史最少可用大小 = 59952字节
释放D3域SRAM动态内存区申请的5111字节，当前共使用大小 = 16字节，当前剩余大小 = 65520字节，历史最少可用大小 = 59952字节

```

